# Wikifier::Page

`Wikifier::Page` is a programming interface for working with a single wiki
page or article.

## Constructor

```perl
my $page = Wikifier::Page->new(%opts)
```

Creates a new page object. The object may be associated with a page file. You
should only use this constructor if working with page objects independently of a
Wikifier::Wiki. Otherwise, use [`Wikifier::Wiki::page_named()`](wiki.md#pagenamed).

__%opts__ - hash of options
* __wikifier__ - _optional_, wikifier instance to reuse
* __file_path__ - _optional_, page file path (if not specified, `name` is
  required)
* __name__ - _optional_, page file basename (if not specified, `file_path` is
  required; basename of `file_path` is used as page name)
* __vars_only__ - _optional_, if true, only variables will be parsed, not page
  content
* __source__ - _optional_, page source code written in the wikifier language.
  if not provided, the file specified by `file_path` is required and will be
  read and parsed instead

## parse

```perl
my $err = $page->parse;
die "Failed to parse page: $err\n";
```

Parses the page, returning an error on failure, otherwise nothing.

## html

```perl
my $html = $page->html;
```

Generates and returns HTML for the page. [`->parse`](#parse) MUST be called
before this.

## css

Generates and returns CSS for the page. [`->html`](#html) MUST be called before
this.

## set

```perl
$page->set(my_var => 'some value');
```

Assigns a value to a page variable.

## get

```perl
my $val = $page->get('my_var');
```

Fetches the value of a page variable. Returns undef if nothing exists there.

## parse_formatted_text

```perl
my $text = 'Hello, [b]World[/b]!';
say $page->parse_formatted_text($text); # "Hello, <b>World</b>!"
```

Translates [wiki formatting codes](../language.md#text-formatting) to HTML.

## opt

```perl
say "Welcome to ", $page->opt('name'); # "Welcome to My Wiki!"
```

Fetches a wiki configuration option.

## page_opt

```perl
if ($page->page_opt('page.enable.title')) {
    $show_title++;
}
```

Like [`opt`](#opt) except it checks the page itself for the option before
consulting the wiki configuration.

## name

```perl
$page->name     # "some_page.page"
```

Name of the page including the file extension.

## name_ne

```perl
$page->name_ne  # "some_page"
```

Name of the page without the file extension.

## prefix

```perl
# assuming $page->name is "hello/world.page"
$page->prefix   # "hello"
```

Returns the page prefix; i.e. the subdirectory within the page directory at
which this page exists. If the page is at root level, returns undef.

## rel_name

```perl
$page->rel_name
```

Returns the page name relative to the page directory. Unlike [`->name`](#name),
this does not take redirects/symlinks into account.

## rel_name_ne

```perl
$page->rel_name_ne
```

Like [`rel_name`](#rel_name), except without the file extension.

## rel_path

```perl
$page->rel_path
```

Returns the relative path to the page. This is actually an absolute path, but
it is called relative because, unlike [`path`](#path), symlinks are not taken
into account.

## redirect

```perl
if (length(my $redir = $page->redirect)) {
    say "Redirecting to $redir";
}
```

Location to which this page redirects. This may be a relative or absolute
URL, suitable for use in a Location header. Returns undef if the page does not
redirect.

## path

```perl
$page->path
```

Absolute path to the page file.

## created

```
$page->created
```

UNIX timestamp of page creation, according to the
[`@page.created`](../language.md#special-variables) special variable. If the
variable is not defined or is not provided in an accepted format, returns a
false value.

## modified

```perl
$page->modified
```

UNIX timestamp at which the page file was last modified as reported by the
filesystem.

## cache_path

```perl
$page->cache_path
```

Absolute path to the page cache file which may or may not exist.

## cache_modified

```perl
$page->cache_modified
```

UNIX timestamp at which the page cache file was last modified as reported by the
filesystem.

## search_path

```perl
$page->search_path
```

Absolute path to the plaintext page search file which may or may not exist.

## draft

```perl
$page->draft
```

True if the page is marked as a draft by the special
[`@page.draft`](../language.md#special-variables) variable.

## generated


```perl
$page->generated
```

True if the page is marked as autogenerated by the special
[`@page.generated`](../language.md#special-variables) variable.

## author

```perl
$page->author
```

Author of the page, as specified by the special
[`@page.author`](../language.md#special-variables) variable. Returns undef if
the author is unspecified.

## fmt_title

```perl
$page->fmt_title
```

HTML-formatted page title.

## title

```perl
$page->title
```

Like [`fmt_title`](#fmt_title), except HTML tags have been stripped.

## title_or_name

```perl
$page->title_or_name
```

Returns the page title if available, without HTML formatting; otherwise the
page filename.

## pos

```perl
$page->pos
```

During parsing, returns the current position within the page. After parsing,
this refers to the first line of the page file so that any possible
improperly-positioned warnings are still visible.

## warning

```perl
$page->warning($pos, 'Something has gone wrong');
```

Produces a page warning at the specified position. If the position argument
is omitted, the value of [`->pos`](#pos) is used.

## page_info

```perl
$page->page_info
```

Returns a hash reference of page metadata suitable for JSON serialization.
